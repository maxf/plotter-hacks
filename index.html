<!DOCTYPE HTML>
<html>
  <head>
    <title>Celtic</title>
    <script src="celtic.js?x=2"></script>
    <style>
     body {
       margin: 0;
       font-family: sans;
     }
     #canvas {
       width: 100vw;
       height: 100vh;
     }
     #controls {
       position: absolute;
       top: 0;
       background: #ddd;
       padding: 5px;
       border: 1px solid black;
       opacity: 0.8;
     }
    </style>
  </head>
  <body>
    <svg id="canvas"></svg>
    <div id="controls">
      <select id="graph-type">
        <option>Polar</option>
        <option>Grid</option>
      </select><br/>
      <input id="margin" type="range" min="0" max="500" step="1" /> margin: <span id="margin-value"></span><br/>
      <input id="shape1" type="range" min="-2" max="2" step="0.01" /> shape1: <span id="shape1-value"></span><br/>
      <input id="shape2" type="range" min="-2" max="2" step="0.01" /> shape2: <span id="shape2-value"></span><br/>
      <input id="nbOrbits" type="range" min="0" max="20" step="1" /> nbOrbits: <span id="nbOrbits-value"></span><br/>
      <input id="nbNodesPerOrbit" type="range" min="4" max="20" step="1" /> nbNodesPerOrbits: <span id="nbNodesPerOrbit-value"></span><br/>
      <input id="cells" type="range" min="2" max="100" step="1" /> cells: <span id="cells-value"></span><br/>
    </div>

    <script>
     const $ = id => document.getElementById(id);

     const go = () => {
       const params = {
         width,
         height,
         shape1,
         shape2,
         margin,
         graphType,
         nbOrbits,
         nbNodesPerOrbit,
         cells,
       };
       console.log(params);
       $('canvas').outerHTML = celticDraw(params);
     }

     const fetchParamsAndRun = () => {
       graphType = $('graph-type').value;
       shape1 = parseFloat($('shape1').value);
       shape2 = parseFloat($('shape2').value);
       nbOrbits = parseInt($('nbOrbits').value);
       nbNodesPerOrbit = parseInt($('nbNodesPerOrbit').value);
       cells = parseInt($('cells').value);
       margin = parseInt($('margin').value);

       $('shape1-value').innerText = shape1;
       $('shape2-value').innerText = shape2;
       $('margin-value').innerText = margin;
       $('nbOrbits-value').innerText = nbOrbits;
       $('nbNodesPerOrbit-value').innerText = nbNodesPerOrbit;
       $('cells-value').innerText = cells;
       go()
     }

     const setGraphTypeControls = () => {
       switch ($("graph-type").value) {
         case "Polar":
           $("cells").disabled = true;
           $("nbOrbits").disabled = false;
           $("nbNodesPerOrbit").disabled = false;
           break;
         case "Grid":
           $("cells").disabled = false;
           $("nbOrbits").disabled = true;
           $("nbNodesPerOrbit").disabled = true;
           break;
       }
       fetchParamsAndRun();
     }

     var canvas = $("canvas");
     var rect = canvas.getBoundingClientRect();
     let width = rect.width;
     let height = rect.height;
     let margin = 100;
     let shape1 = 1;
     let shape2 = -1.2;
     let graphType = 'Polar';
     let nbOrbits = 4;
     let nbNodesPerOrbit = 6;
     let cells = 10;
     $('shape1').value = shape1;
     $('shape2').value = shape2;
     $('margin').value = margin;
     $('graph-type').value = graphType;
     $('nbOrbits').value = nbOrbits;
     $('nbNodesPerOrbit').value = nbNodesPerOrbit;
     $('cells').value = cells;
     $('shape1-value').innerText = shape1;
     $('shape2-value').innerText = shape2;
     $('nbOrbits-value').innerText = nbOrbits;
     $('nbNodesPerOrbit-value').innerText = nbNodesPerOrbit;

     setGraphTypeControls();

     go();

     $('shape1').addEventListener('change', fetchParamsAndRun);
     $('shape2').addEventListener('change', fetchParamsAndRun);
     $('margin').addEventListener('change', fetchParamsAndRun);
     $('graph-type').addEventListener('change', setGraphTypeControls);
     $('nbOrbits').addEventListener('change', fetchParamsAndRun);
     $('nbNodesPerOrbit').addEventListener('change', fetchParamsAndRun);
     $('cells').addEventListener('change', fetchParamsAndRun);
    </script>
  </body>
</html>
